---
type: update
version: 1.5.2
name: Jahia - Reset Kibana admin users's password
logo: ../../assets/common/jahia-logo-70x70.png
id: jahia-reset-kibana-admin-password
description:
  short: Jahia - Reset the Kibana admin user's password


mixins:
  - ../../mixins/common.yml
  - ../../mixins/jcustomer.yml
  - ../../mixins/elasticsearch.yml

globals:
  __secret__kibanaAdminpassword: ${fn.password(20)}

onInstall:
- setGlobals:
    kibanaAdminAccountName: ${settings.jahiaenv}-kibana-admin
- resetESAccountPassword:
    username: ${globals.kibanaAdminAccountName}
    __secret__password: ${globals.__secret__kibanaAdminpassword}
- set:
    __secret__returnMessage: '{"kibana_admin_account_name": "${globals.kibanaAdminAccountName}", "kibana_admin_password": "${globals.__secret__kibanaAdminpassword}"}'
- return:
    type: success
    message: '${this.__secret__returnMessage.toBase64()}'

settings:
  fields:
    - name: jahiaenv
      type: envlist
      caption: Target Jahia env
      required: true
      valueField: shortdomain
